<footer class="p-4 md:p-6 pt-2 bg-white dark:bg-zinc-950 flex-shrink-0 z-20">
  
  <!-- Pending Attachments Preview -->
  @if (pendingAttachments.length > 0 || isUploading) {
    <div class="flex gap-2 px-2 pb-2 overflow-x-auto">
      @for (att of pendingAttachments; track att.id) {
        <div class="relative group flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border border-zinc-200 dark:border-zinc-800 bg-zinc-100 dark:bg-zinc-800">
          @if (isImageAttachment(att)) {
            <img [src]="att.url" class="w-full h-full object-cover">
          } @else {
            <div class="w-full h-full flex items-center justify-center text-zinc-400">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
              </svg>
            </div>
          }
          <button 
            (click)="removeAttachment.emit(att.id)" 
            class="absolute top-0.5 right-0.5 bg-black/50 text-white rounded-full p-0.5 hover:bg-red-500 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3">
              <path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z" />
            </svg>
          </button>
        </div>
      }
      @if (isUploading) {
        <div class="flex-shrink-0 w-16 h-16 rounded-lg bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center animate-pulse">
          <span class="text-xs text-zinc-400">...</span>
        </div>
      }
    </div>
  }

  <!-- Input Container -->
  <div class="flex items-end gap-2 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-3xl p-2 pl-4 shadow-sm focus-within:ring-2 focus-within:ring-indigo-500/20 focus-within:border-indigo-500/50 transition-all">
    
    <!-- Hidden file input -->
    <input 
      type="file" 
      #fileInput 
      (change)="onFileChange($event)" 
      class="hidden" 
      accept="image/*,application/pdf,.doc,.docx,.xls,.xlsx"
    >

    <!-- Attach button -->
    <button 
      (click)="triggerFileInput()" 
      [disabled]="isUploading"
      class="p-2 mb-0.5 text-zinc-400 hover:text-indigo-500 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-full transition-colors flex-shrink-0 disabled:opacity-50">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13" />
      </svg>
    </button>
    
    <!-- Text input -->
    <textarea 
      [ngModel]="messageText"
      (ngModelChange)="messageTextChange.emit($event)"
      (keydown)="onKeydown($event)"
      rows="1"
      placeholder="Type your message..."
      class="w-full bg-transparent border-none focus:ring-0 text-sm py-3.5 px-2 max-h-32 min-h-[48px] resize-none text-zinc-900 dark:text-zinc-100 placeholder-zinc-400 scrollbar-hide"
    ></textarea>
    
    <!-- Send button -->
    <button 
      (click)="sendMessage.emit()" 
      [disabled]="!canSend || isSending"
      class="p-2.5 mb-1 rounded-full text-white shadow-lg shadow-indigo-500/30 transition-all duration-200 flex-shrink-0"
      [class.bg-indigo-600]="canSend"
      [class.hover:bg-indigo-700]="canSend"
      [class.scale-100]="canSend"
      [class.bg-zinc-300]="!canSend"
      [class.dark:bg-zinc-800]="!canSend"
      [class.scale-90]="!canSend"
      [class.opacity-70]="!canSend"
      [class.cursor-not-allowed]="!canSend">
      @if (isSending) {
        <svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
      } @else {
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 translate-x-0.5">
          <path d="M3.105 2.289a.75.75 0 0 0-.826.95l1.414 4.925A1.5 1.5 0 0 0 5.135 9.25h6.115a.75.75 0 0 1 0 1.5H5.135a1.5 1.5 0 0 0-1.442 1.086l-1.414 4.926a.75.75 0 0 0 .826.95 28.89 28.89 0 0 0 15.293-7.154.75.75 0 0 0 0-1.115A28.897 28.897 0 0 0 3.105 2.289Z" />
        </svg>
      }
    </button>
  </div>
</footer>
